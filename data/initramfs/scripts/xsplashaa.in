#!/bin/sh

PREREQ=""

prereqs()
{
    echo "$PREREQ"
}

case $1 in
prereqs)
    prereqs
    exit 0
    ;;
esac

SPLASH=false
VERBOSE=true
JAIL="@chrootdir@"

for x in $(cat /proc/cmdline); do
    case $x in
    splash*)
        SPLASH=true
        ;;
    quiet*)
        VERBOSE=false
        ;;
    esac
done

if [ $SPLASH = "true" ]; then
    mkdir -p $JAIL
    cp -dR /etc $JAIL
    cp -dR /bin $JAIL
    cp -dR /sbin $JAIL
    cp -dR /lib $JAIL
    cp -dR /lib64 $JAIL
    cp -dR /usr $JAIL
    mkdir -p $JAIL/dev
    mount -o bind /dev $JAIL/dev
    mkdir -p $JAIL/sys
    mount -t sysfs none $JAIL/sys
    mkdir -p $JAIL/proc
    mount -t proc none $JAIL/proc
    mkdir -p $JAIL/tmp
    mkdir -p $JAIL/var/lib/xkb
    cp -dR /var/lib/defoma $JAIL/var/lib/defoma

    chroot $JAIL /usr/bin/xsplashaa
fi
